---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProjectCarousel from '@/components/portfolio/ProjectCarousel.astro';
import ClientLogos from '@/components/home/ClientLogos.astro';
import Capabilities from '@/components/home/Capabilities.astro';
import DesignerSpotlight from '@/components/home/DesignerSpotlight.astro';

// Get all non-draft, non-self-initiated projects for the main carousel
const projects = await getCollection('projects', ({ data }) =>
  !data.draft && data.client !== 'Self-initiated'
);
const sortedProjects = projects.sort((a, b) => {
  if (a.data.order !== undefined && b.data.order !== undefined) {
    return a.data.order - b.data.order;
  }
  if (a.data.order !== undefined) return -1;
  if (b.data.order !== undefined) return 1;
  return b.data.publishedDate.getTime() - a.data.publishedDate.getTime();
});
---

<BaseLayout>
  <!-- Collins-inspired Immersive Hero -->
  <section class="hero">
    <div class="hero-content">
      <h1 class="hero-title">
        <span class="hero-line" style="--delay: 0.1s">Quality</span>
        <span class="hero-line" style="--delay: 0.2s">Time</span>
      </h1>
      <p class="hero-tagline" style="--delay: 0.4s">
        Design Studio
      </p>
      <p class="hero-services" style="--delay: 0.5s">
        Branding / Systems / Craft
      </p>
    </div>

    <div class="hero-scroll" style="--delay: 0.8s">
      <span class="scroll-text">Scroll to explore</span>
      <span class="scroll-arrow">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 5v14M5 12l7 7 7-7"/>
        </svg>
      </span>
    </div>
  </section>

  <!-- Selected Clients -->
  <ClientLogos />

  <!-- Work Section with Carousel -->
  <section class="work" id="work">
    <header class="section-header">
      <span class="section-label" data-animate>Selected Work</span>
      <h2 class="section-title" data-animate style="--stagger: 1">
        Recent projects and collaborations
      </h2>
    </header>

    <ProjectCarousel projects={sortedProjects} />
  </section>

  <!-- Capabilities -->
  <Capabilities />

  <!-- Meet Our Designers -->
  <DesignerSpotlight />
</BaseLayout>

<style>
  /* ==========================================================================
     Collins-inspired Immersive Hero
     ========================================================================== */
  .hero {
    position: relative;
    min-height: var(--hero-height);
    min-height: max(var(--hero-min-height), var(--hero-height));
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: var(--space-32) var(--gutter);
    overflow: hidden;
  }

  .hero-content {
    max-width: var(--container-xl);
  }

  .hero-title {
    font-family: var(--font-display);
    font-size: var(--text-hero);
    font-weight: var(--font-regular);
    line-height: var(--leading-hero);
    letter-spacing: var(--tracking-tightest);
    margin-bottom: var(--space-6);
  }

  .hero-line {
    display: block;
    opacity: 0;
    transform: translateY(40px);
    animation: heroReveal 0.8s var(--ease-spring-soft) forwards;
    animation-delay: var(--delay, 0s);
  }

  /* Collins-style offset for visual interest */
  .hero-line:nth-child(2) {
    margin-left: 0.12em;
  }

  .hero-tagline {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    font-style: italic;
    color: var(--color-text-secondary);
    margin-top: var(--space-4);
    opacity: 0;
    transform: translateY(30px);
    animation: heroReveal 0.7s var(--ease-spring-soft) forwards;
    animation-delay: var(--delay, 0s);
  }

  .hero-services {
    font-family: var(--font-body);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    letter-spacing: var(--tracking-widest);
    text-transform: uppercase;
    color: var(--color-text-muted);
    margin-top: var(--space-6);
    opacity: 0;
    transform: translateY(20px);
    animation: heroReveal 0.6s var(--ease-spring-soft) forwards;
    animation-delay: var(--delay, 0s);
  }

  @keyframes heroReveal {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Scroll indicator at bottom */
  .hero-scroll {
    position: absolute;
    bottom: var(--space-12);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-3);
    color: var(--color-text-muted);
    opacity: 0;
    animation: heroReveal 0.6s var(--ease-spring-soft) forwards;
    animation-delay: var(--delay, 0s);
  }

  .scroll-text {
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    letter-spacing: var(--tracking-widest);
    text-transform: uppercase;
  }

  .scroll-arrow {
    animation: bounceDown 2s var(--ease-spring-soft) infinite;
    animation-delay: 1s;
  }

  /* ==========================================================================
     Work Section
     ========================================================================== */
  .work {
    padding: var(--section-gap) 0;
  }

  .section-header {
    padding: 0 var(--gutter) var(--space-12);
    max-width: var(--container-xl);
    margin: 0 auto;
  }

  .section-label {
    display: block;
    font-family: var(--font-body);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    letter-spacing: var(--tracking-caps);
    text-transform: uppercase;
    color: var(--color-text-muted);
    margin-bottom: var(--space-3);
  }

  .section-title {
    font-family: var(--font-display);
    font-size: var(--text-display);
    font-weight: var(--font-regular);
    line-height: var(--leading-display);
    letter-spacing: var(--tracking-tighter);
    color: var(--color-text-primary);
    max-width: 15ch;
  }

  /* ==========================================================================
     Responsive
     ========================================================================== */
  @media (max-width: 768px) {
    .hero {
      min-height: 85svh;
      padding-top: var(--space-24);
    }

    .hero-line:nth-child(2) {
      margin-left: 0;
    }

    .hero-scroll {
      display: none;
    }

    .section-title {
      max-width: none;
    }
  }
</style>

<script>
  // Scroll-triggered reveal animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll('[data-animate]').forEach((el) => {
    observer.observe(el);
  });
</script>
