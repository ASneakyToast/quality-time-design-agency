---
import LiveClock from './LiveClock.astro';
import Navigation from './Navigation.astro';

const currentPath = Astro.url.pathname;
---

<header class="header" data-header>
  <div class="header-inner">
    <a href="/" class="logo" aria-label="Quality Time - Home">
      <span class="logo-blob" aria-hidden="true"></span>
      <span class="logo-text">Quality Time</span>
    </a>

    <div class="header-right">
      <LiveClock />
      <Navigation currentPath={currentPath} />
    </div>
  </div>
</header>

<style>
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    padding: var(--space-5) var(--gutter);

    /* Collins-style: start transparent */
    background-color: transparent;

    /* Dynamic overlay that adapts to scroll theme */
    --header-overlay: var(--color-overlay-light);

    transition:
      background-color var(--duration-normal) var(--ease-out),
      backdrop-filter var(--duration-normal) var(--ease-out);
  }

  /* When body is in dark theme, use dark overlay */
  :global(body[data-theme="dark"]) .header {
    --header-overlay: var(--color-overlay-dark);
  }

  /* Scrolled state with blur backdrop (Collins-style) */
  .header.is-scrolled {
    background-color: var(--header-overlay);
    backdrop-filter: var(--backdrop-blur-md);
    -webkit-backdrop-filter: var(--backdrop-blur-md);
  }

  .header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: var(--container-max);
    margin: 0 auto;
  }

  .logo {
    position: relative;
    display: flex;
    align-items: center;
    text-decoration: none;
    transition: transform var(--duration-fast) var(--ease-spring);
  }

  .logo:hover {
    opacity: 1;
    transform: translateX(-2px);
  }

  .logo-blob {
    position: absolute;
    inset: -20px -30px;
    background: radial-gradient(
      ellipse 100% 80% at center,
      rgba(255, 118, 0, 0.15) 0%,
      rgba(255, 118, 0, 0.05) 50%,
      transparent 80%
    );
    filter: blur(12px);
    opacity: 0;
    transition: opacity 0.4s var(--ease-out);
    pointer-events: none;
    z-index: -1;
  }

  .logo:hover .logo-blob {
    opacity: 1;
  }

  .logo-text {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    font-weight: var(--font-regular);
    letter-spacing: var(--tracking-tight);
    color: var(--color-text-primary);
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: var(--space-8);
  }

  @media (max-width: 640px) {
    .header-right {
      gap: var(--space-5);
    }
  }
</style>

<script>
  // Collins-style transparent-to-blur header on scroll
  const header = document.querySelector('[data-header]');
  const scrollThreshold = 100;

  const updateScrollState = () => {
    const scrolled = window.scrollY > scrollThreshold;
    header?.classList.toggle('is-scrolled', scrolled);
  };

  window.addEventListener('scroll', updateScrollState, { passive: true });
  updateScrollState();
</script>
