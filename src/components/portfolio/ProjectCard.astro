---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';

interface Props {
  project: CollectionEntry<'projects'>;
  index?: number;
  priority?: boolean;
}

const { project, index = 0, priority = false } = Astro.props;
const { title, client, thumbnail, services, year } = project.data;

// Format services for display
const serviceLabels: Record<string, string> = {
  'branding': 'Branding',
  'web-design': 'Web Design',
  'ui-ux': 'UI/UX',
  'print': 'Print',
  'packaging': 'Packaging',
  'illustration': 'Illustration',
  'motion': 'Motion',
  'photography': 'Photography',
};
---

<article class="card" style={`--index: ${index}`} data-animate style={`--stagger: ${index}`}>
  <a href={`/projects/${project.id}`} class="card-link">
    <div class="card-image-wrapper">
      <Image
        src={thumbnail}
        alt={`${title} project thumbnail`}
        widths={[400, 600, 800, 1000]}
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 40vw"
        loading={priority ? 'eager' : 'lazy'}
        class="card-image"
      />
      <div class="card-overlay" aria-hidden="true">
        <span class="card-view">
          <span>View Project</span>
          <svg class="arrow-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </span>
      </div>
    </div>

    <div class="card-content">
      <div class="card-meta">
        <span class="card-client">{client}</span>
        <span class="card-divider">Â·</span>
        <span class="card-year">{year}</span>
      </div>
      <h3 class="card-title">{title}</h3>
      <div class="card-services">
        {services.slice(0, 3).map((service, i) => (
          <span class="card-service">
            {serviceLabels[service] || service}
            {i < Math.min(services.length, 3) - 1 && ', '}
          </span>
        ))}
      </div>
    </div>
  </a>
</article>

<style>
  /* ==========================================================================
     Collins-inspired Project Card with 3D Perspective
     ========================================================================== */
  .card {
    perspective: var(--perspective);
  }

  .card-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .card-link:hover {
    opacity: 1;
  }

  /* ==========================================================================
     Image with 3D Transform
     ========================================================================== */
  .card-image-wrapper {
    position: relative;
    aspect-ratio: 4 / 3;
    overflow: hidden;
    background-color: var(--color-bg-tertiary);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-5);
    transform-style: preserve-3d;
    transition: transform var(--duration-slow) var(--ease-spring);
  }

  /* 3D perspective on hover */
  .card-link:hover .card-image-wrapper {
    transform: rotateX(-2deg) rotateY(2deg) translateY(-8px);
  }

  .card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--duration-slow) var(--ease-spring);
  }

  .card-link:hover .card-image {
    transform: scale(var(--scale-hover));
  }

  /* Overlay with blur */
  .card-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-overlay-dark);
    backdrop-filter: var(--backdrop-blur-sm);
    -webkit-backdrop-filter: var(--backdrop-blur-sm);
    opacity: 0;
    transition: opacity var(--duration-normal) var(--ease-out);
    border-radius: var(--radius-lg);
  }

  .card-link:hover .card-overlay {
    opacity: 1;
  }

  .card-view {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-family: var(--font-body);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    letter-spacing: var(--tracking-wide);
    text-transform: uppercase;
    color: white;
    padding: var(--space-3) var(--space-5);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: var(--radius-full);
    transform: translateY(8px);
    transition: all var(--duration-normal) var(--ease-spring);
  }

  .card-link:hover .card-view {
    transform: translateY(0);
    gap: var(--space-3);
  }

  .arrow-icon {
    transition: transform var(--duration-fast) var(--ease-spring);
  }

  .card-link:hover .arrow-icon {
    transform: translateX(3px);
  }

  /* ==========================================================================
     Card Content
     ========================================================================== */
  .card-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .card-meta {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    letter-spacing: var(--tracking-wide);
    text-transform: uppercase;
    color: var(--color-text-muted);
  }

  .card-divider {
    opacity: 0.4;
  }

  .card-title {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    font-weight: var(--font-regular);
    line-height: var(--leading-snug);
    letter-spacing: var(--tracking-tight);
    color: var(--color-text-primary);
    margin: 0;
    transition: color var(--duration-fast) var(--ease-out);
  }

  .card-link:hover .card-title {
    color: var(--color-accent);
  }

  .card-services {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);
    margin-top: var(--space-1);
  }

  .card-service {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  /* ==========================================================================
     Responsive
     ========================================================================== */
  @media (max-width: 768px) {
    .card-link:hover .card-image-wrapper {
      transform: translateY(-4px);
    }

    .card-title {
      font-size: var(--text-xl);
    }
  }

  @media (max-width: 640px) {
    .card-title {
      font-size: var(--text-lg);
    }
  }
</style>
